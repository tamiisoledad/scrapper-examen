name: ğŸ“… IIC Buenos Aires - Alerta Semanal del Sistema

on:
  # Ejecutar todos los jueves a las 9:00 AM hora argentina (12:00 PM UTC)
  schedule:
    - cron: '0 12 * * 4'  # 0 minutos, 12 horas, cualquier dÃ­a del mes, cualquier mes, jueves (4)
  
  # Permitir ejecuciÃ³n manual
  workflow_dispatch:

# Permisos necesarios
permissions:
  contents: read
  actions: read

jobs:
  weekly-alert:
    name: ğŸ’š Enviar Alerta Semanal
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout del repositorio
        uses: actions/checkout@v4
        
      - name: ğŸŸ¢ Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“¦ Instalar dependencias
        run: npm ci
        
      - name: ğŸ“… Enviar alerta semanal del sistema
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          EMAIL_TO_1: ${{ secrets.EMAIL_TO_1 }}
          EMAIL_TO_2: ${{ secrets.EMAIL_TO_2 }}
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
        run: |
          echo "ğŸ“… Iniciando alerta semanal a las $(date)"
          echo "ğŸŒ Timezone: $(date +'%Z %z')"
          echo "ğŸ‡¦ğŸ‡· Hora Argentina: $(TZ='America/Argentina/Buenos_Aires' date)"
          echo "ğŸ“§ Enviando reporte semanal de estado del sistema..."
          node weekly-alert.js
          
      - name: ğŸ“Š InformaciÃ³n de la alerta semanal
        if: always()
        run: |
          echo "âœ… Alerta semanal completada a las $(date)"
          echo "ğŸ‡¦ğŸ‡· Hora actual en Argentina: $(TZ='America/Argentina/Buenos_Aires' date)"
          echo "ğŸ“… Esta alerta se ejecuta todos los JUEVES a las 9:00 AM ARG"
          echo "ğŸ’š PropÃ³sito: Confirmar que el sistema de monitoreo estÃ¡ activo"
          echo "â° PrÃ³xima alerta semanal: Jueves siguiente a las 9:00 AM ARG"
          echo ""
          echo "ğŸ”„ Recordatorio de horarios del monitoreo principal:"
          echo "   â€¢ ğŸŒ… 7:00 AM ARG (10:00 UTC) - VerificaciÃ³n matutina"
          echo "   â€¢ ğŸŒ 1:00 PM ARG (16:00 UTC) - VerificaciÃ³n del mediodÃ­a" 
          echo "   â€¢ ğŸŒ™ 7:00 PM ARG (22:00 UTC) - VerificaciÃ³n vespertina"